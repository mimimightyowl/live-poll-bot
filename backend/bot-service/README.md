# Bot Service - Telegram Bot –¥–ª—è Live Poll

Telegram-–±–æ—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø—Ä–æ—Å–æ–≤ —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Å—Å—ã–ª–æ–∫ –Ω–∞ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –°–æ–∑–¥–∞–π—Ç–µ Telegram –±–æ—Ç–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –Ω–∞–π–¥–∏—Ç–µ [@BotFather](https://t.me/botfather)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot`
3. –ü—Ä–∏–¥—É–º–∞–π—Ç–µ –∏–º—è –¥–ª—è –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `My Live Poll Bot`)
4. –ü—Ä–∏–¥—É–º–∞–π—Ç–µ username –¥–ª—è –±–æ—Ç–∞ (–¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ `bot`, –Ω–∞–ø—Ä–∏–º–µ—Ä: `mylivepolls_bot`)
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–¥–∞—Å—Ç BotFather

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

```bash
cd backend/bot-service
cp .env.development.example .env.development
```

–û—Ç–∫—Ä–æ–π—Ç–µ `.env.development` –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à —Ç–æ–∫–µ–Ω:

```env
TELEGRAM_BOT_TOKEN=your_actual_token_here
API_SERVICE_GRPC_URL=localhost:50051
FRONTEND_URL=http://localhost:5174
NODE_ENV=development
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
npm install
```

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã

**–í —Ä–∞–∑–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–∞—Ö:**

```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
npm run docker:db

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: API Service (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –¥–ª—è gRPC)
cd backend/api-service
npm run dev

# –¢–µ—Ä–º–∏–Ω–∞–ª 3: Bot Service
cd backend/bot-service
npm run dev
```

**–ò–ª–∏ –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞:**

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å API + Realtime + Bot
npm run dev && npm run dev:bot
```

## üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### `/start`

–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü—Ä–∏–º–µ—Ä:**

```
/start
```

**–û—Ç–≤–µ—Ç:**

```
üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Live Poll Bot!

–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –æ–ø—Ä–æ—Å—ã –∏ –¥–µ–ª–∏—Ç–µ—Å—å —Å—Å—ã–ª–∫–∞–º–∏ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è.

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /help –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥.
```

---

### `/createpoll "–í–æ–ø—Ä–æ—Å"`

–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ–ø—Ä–æ—Å–∞

**–í–∞–∂–Ω–æ:** –í–æ–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –∫–∞–≤—ã—á–∫–∞—Ö!

**–ü—Ä–∏–º–µ—Ä:**

```
/createpoll "–ö–∞–∫–æ–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –ª—É—á—à–µ?"
```

**–û—Ç–≤–µ—Ç:**

```
‚úÖ –û–ø—Ä–æ—Å —Å–æ–∑–¥–∞–Ω!

üìä –í–æ–ø—Ä–æ—Å: –ö–∞–∫–æ–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –ª—É—á—à–µ?

üîó –°—Å—ã–ª–∫–∞ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è:
http://localhost:5174/poll/1/vote

–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —ç—Ç–æ–π —Å—Å—ã–ª–∫–æ–π —Å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –æ–ø—Ä–æ—Å–∞.
–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏!
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**

- ‚úÖ –ú–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞
- ‚úÖ –ú–∞–∫—Å–∏–º—É–º 500 —Å–∏–º–≤–æ–ª–æ–≤
- ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤ –∫–∞–≤—ã—á–∫–∞—Ö

---

### `/mypolls`

–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–∞—à–∏—Ö –æ–ø—Ä–æ—Å–æ–≤

**–ü—Ä–∏–º–µ—Ä:**

```
/mypolls
```

**–û—Ç–≤–µ—Ç:**

```
üìä –í–∞—à–∏ –æ–ø—Ä–æ—Å—ã (2):

1. –ö–∞–∫–æ–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –ª—É—á—à–µ?
   üîó http://localhost:5174/poll/1/vote

2. –ö–∞–∫–æ–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?
   üîó http://localhost:5174/poll/2/vote
```

---

### `/poll <id>`

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–ø—Ä–æ—Å–µ –∏ —Ç–µ–∫—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–ü—Ä–∏–º–µ—Ä:**

```
/poll 1
```

**–û—Ç–≤–µ—Ç:**

```
üìä –û–ø—Ä–æ—Å #1

‚ùì –í–æ–ø—Ä–æ—Å: –ö–∞–∫–æ–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –ª—É—á—à–µ?

üîó –°—Å—ã–ª–∫–∞ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è:
http://localhost:5174/poll/1/vote

üìà –¢–µ–∫—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
  ‚Ä¢ Python: 5 (50%)
  ‚Ä¢ JavaScript: 3 (30%)
  ‚Ä¢ Go: 2 (20%)

–í—Å–µ–≥–æ –≥–æ–ª–æ—Å–æ–≤: 10
```

---

### `/help`

–°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º

**–ü—Ä–∏–º–µ—Ä:**

```
/help
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram    ‚îÇ
‚îÇ  Bot API     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ BOT SERVICE  ‚îÇ
‚îÇ              ‚îÇ
‚îÇ Telegraf     ‚îÇ
‚îÇ gRPC Client  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ gRPC (50051)
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ API SERVICE  ‚îÇ
‚îÇ              ‚îÇ
‚îÇ REST + gRPC  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Telegraf** - Telegram Bot Framework
- **gRPC** - –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —Å API Service
- **TypeScript** - –¢–∏–ø–∏–∑–∞—Ü–∏—è
- **Proto-loader** - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ .proto —Ñ–∞–π–ª–æ–≤

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
bot-service/
‚îú‚îÄ‚îÄ proto/                    # gRPC –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ polls.proto          # Polls Service proto
‚îÇ   ‚îî‚îÄ‚îÄ users.proto          # Users Service proto
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ bot.ts               # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ index.ts             # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ config/              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ polls/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ polls.client.ts    # gRPC –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ polls.service.ts   # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ polls.handler.ts   # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ users/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ users.client.ts    # gRPC –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ users.service.ts   # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ users.handler.ts   # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îî‚îÄ‚îÄ shared/
‚îÇ       ‚îú‚îÄ‚îÄ env.ts           # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îÇ       ‚îú‚îÄ‚îÄ logger.ts        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ       ‚îî‚îÄ‚îÄ errors/          # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îî‚îÄ‚îÄ package.json
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –°–æ–∑–¥–∞–Ω–∏–µ –æ–ø—Ä–æ—Å–∞

1. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram –ø–æ username
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/createpoll "–¢–µ—Å—Ç–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å?"`
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ–ø—Ä–æ—Å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—Ä–æ—Å–º–æ—Ç—Ä –æ–ø—Ä–æ—Å–æ–≤

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/mypolls`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –≤–∞—à–∏—Ö –æ–ø—Ä–æ—Å–æ–≤
3. –í—ã–±–µ—Ä–∏—Ç–µ ID –æ–ø—Ä–æ—Å–∞
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/poll <id>`
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–ø—Ä–æ—Å–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

1. –°–æ–∑–¥–∞–π—Ç–µ –æ–ø—Ä–æ—Å —á–µ—Ä–µ–∑ –±–æ—Ç–∞
2. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É –∏ –ø—Ä–æ–≥–æ–ª–æ—Å—É–π—Ç–µ
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/poll <id>` –±–æ—Ç—É
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±–Ω–æ–≤–∏–ª–∏—Å—å

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**

1. ‚úÖ API Service –∑–∞–ø—É—â–µ–Ω (`localhost:3000`)
2. ‚úÖ gRPC —Å–µ—Ä–≤–µ—Ä API –∑–∞–ø—É—â–µ–Ω (–ø–æ—Ä—Ç 50051)
3. ‚úÖ `TELEGRAM_BOT_TOKEN` –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
4. ‚úÖ –í –ª–æ–≥–∞—Ö –Ω–µ—Ç –æ—à–∏–±–æ–∫

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API Service
curl http://localhost:3000/health

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞
cd backend/bot-service
npm run dev
```

### –û—à–∏–±–∫–∞ "TELEGRAM_BOT_TOKEN is not set"

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª `.env.development`:

```bash
cat .env.development
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–±–µ–∑ –∫–∞–≤—ã—á–µ–∫).

### –û—à–∏–±–∫–∞ gRPC –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ API Service –∑–∞–ø—É—â–µ–Ω:

```bash
# –í –ª–æ–≥–∞—Ö API Service –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# [INFO] gRPC server running on port 50051
```

## üìù –õ–æ–≥–∏

–ë–æ—Ç –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è:

```
[2024-01-15T10:30:00.000Z] [INFO] Starting Telegram Bot Service...
[2024-01-15T10:30:01.000Z] [INFO] Telegram bot launched successfully
[2024-01-15T10:30:05.000Z] [INFO] New WebSocket connection established
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚ö†Ô∏è **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ** `.env.development` —Å —Ä–µ–∞–ª—å–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º
- ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.env.development.example` –∫–∞–∫ —à–∞–±–ª–æ–Ω
- ‚úÖ –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ –≤–∞—à–µ–º—É –±–æ—Ç—É
- ‚úÖ gRPC –∏—Å–ø–æ–ª—å–∑—É–µ—Ç insecure mode (—Ç–æ–ª—å–∫–æ –¥–ª—è development)

## üöÄ Production

–î–ª—è production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:

1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ `.env` —Ñ–∞–π–ª–æ–≤
2. Secure gRPC credentials
3. HTTPS –¥–ª—è FRONTEND_URL
4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Telegraf Documentation](https://telegraf.js.org/)
- [BotFather Commands](https://core.telegram.org/bots#botfather)
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [gRPC Node.js](https://grpc.io/docs/languages/node/)
